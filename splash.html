<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Simple Bill Management</title>
    <link rel="stylesheet" href="css/test.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/splash.css" />
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>
    <script src="js/vendor/modernizr.js"></script>

  </head>
 
  <body onload="newCheckCookie()">

    <div class="row fullWidth" id="tipTopRow"></div>
    
    <div class="row fullWidth" div id="topRow">
      <div class="large-2  xlarge-2 columns">
        <a><img src="img/logoSm.png" id="mainLogo"/></a>
      </div>
      <div class="large-4 columns">
        <ul class="button-group radius even-2 " id="loginButtons">
          <li><a href="#" data-reveal-id="regModal" class="button clearRegForm">Sign up</a></li>
          <li><a href="#" data-reveal-id="loginModal" class=" button clearLoginForm" id="btnLogin">Log in</a></li>
        </ul>
      </div>
    </div>
    
    <div id="middle" >
      <div class="row">
        <div class="large-12  large-centered columns">
           <h1 style = "border-bottom: dotted 1px white;text-align:center;font-weight:bold;">Welcome to <img src="img/paiditkyle.png" height="102" width="152"></h1>
           <p style="font-family:verdana; border-bottom: dotted 1px white;">&emsp;The Center for Financial Security at the University of Wisconsin-Madison is an applied, multidisciplinary research center that seeks to develop
           financial strategies, solutions, and innovations that will enable consumers to become more financially secure. Paidit is a tool that supports 
           this mission by helping people to keep track of their bills in one spot with regular reminders to pay them on time. Prompt bill paying not only 
           leads to better credit history and credit score, but is an essential step towards a stable, financially secure home.</p>
           <br/>

        </div>
      </div>
    </div>
   
    <div id="bottomRow" >
      </br>
      <div class="row">
        <div class="large-12  large-centered columns" style="font-family:verdana;">
           <h1 style = "border-bottom: dotted 1px black;font-weight:bold;">Features:</h1>
           <div class="right"><h6>(*verification is required for each phone/email)</h6></div>
           <ul style="list-style-type:circle;border-bottom: dotted 1px black;">
            <li>Create Bills to receive notification reminders</li>
            <li>Receive your Bill notifications via email* and/or text*</li>
            <li>View your Bill information on useful charts and graphs</li>
            <li>Attach multiple emails*/phone numbers* so you and anyone who needs to know about a due bill can be notified</li>
            <li>A log is kept so you can know what has been sent/created/deleted</li>
            <li>Include reminders so notifications can be sent before a bill is due</li>
          </ul>
        </div>
      </div><br/>
    </div>
    
    <!--  registration modal-->
    <div div id="regModal" class="reveal-modal small" data-reveal aria-labelledby="Sign Up" aria-hidden="true" role="dialog">
      <div class="row">
          <div class="large-6 large-centered columns">
            <a><img src="img/logoSm.png" /></a>
          </div>
        </div>
      <form id="regForm" data-abide name='regForm' onclick="this.disabled = true" >
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Username 
              <input type="text" placeholder="username" id='regUsername' name='regUsername' required/>
            </label>
            <small class="error">username is required </small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Password 
              <input type="password" placeholder="********" id='regPassword' name='regPassword' required />
            </label>
            <small class="error">password is required</small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Confirm Password
              <input type="password" placeholder="*******" id='regPassConfirm' name = 'regPassConfirm' required data-equalto="regPassword"/>
            </label>
            <small class="error">passwords do not match</small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>First Name
              <input type="text" placeholder="first name" id='regFirstName' name='regFirstName'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Last Name
              <input type="text" placeholder="last name" id='regLastName' name='regLastName'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Email Address
              <input type="text" placeholder="you@example.com" id='regEmail' name = 'regEmail'/>
            </label>
          </div>
        </div>

      <div class="large-6 large-centered columns">
        <div class = "row">
        <div class="left">
          <label>Cell Phone <span data-tooltip aria-haspopup="true" class="has-tip right" title="To receive text notifications, a cell phone number and a cell provider is required!">?</span>
            <input type="text" placeholder="555-123-4567" id='regCell' name = 'regCell' style="width:120px;"/>
          </label>
        </div>
        <div class="right">
          <label>Provider</label>
          <select id="mydropdown" name="mydropdown" style="width:100px;">
            <option value="none">Select</option>
            <option value="at&t">at&t</option>
            <option value="sprint">Sprint</option>
            <option value="t-mobile">T-Mobile</option>
            <option value="verizon">Verizon</option>
            <option value="virgin">Virgin</option>
            <option value="boost">Boost</option>
            <option value="alltel">Alltel</option>
          </select>
          
        </div>
        
      </div>
      <div class="clear"></div>
    </div>
        <div class="row">
          <div class="large-6 large-centered columns">
            <div class="left">
            <label>
            <input id="checkbox1" type="checkbox"> Remember Me
            </label></div>
            <div class="right">
            <label>
            <input id="disclaimer" type="checkbox" checked>Allow data collection
            <span data-tooltip aria-haspopup="true" class="has-tip right" title="This allows UW-Madison to use your data for educational purposes.  No names, phone numbers, email addresses, or personal data will be used in any way">?</span>
            </label></div><div class="clear"></div>
          </div>
          
        </div>
  
        <div class="row">
          <div class="large-3 large-centered columns">
            <input href="#" type="button" class="radius button" value="Sign up" id="regSubmit"/>
          </div>
        </div>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
      </form>
    </div>     <!--  registration modal-->

    <!-- Login modal-->
    <div div id="loginModal" class="reveal-modal tiny" data-reveal aria-labelledby="Register" aria-hidden="true" role="dialog">
      <form id ="loginForm" data-abide name='loginForm' >
        
        <div class="row">
          <div class="large-6  large-centered columns">
            <label>Username or Email
              <input type="text" placeholder="username or email" id='loginUsername' name = 'loginUsername'/>
            </label>   
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Password
              <input type="password" placeholder="********" id='loginPassword' name = 'loginPassword'/>
            </label>   
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <input id="checkbox2" type="checkbox"><label for="checkbox2">Remember Me</label>
          </div>
        </div>
         
        <div class="row">
          <div class="large-4 large-centered columns">
            <input href="#" class="radius button" type = "button" value = "Log In" id="loginSubmit"/>
          </div>
        </div>
        <a type='reset' class='close-reveal-modal clearLoginForm' aria-label='Close' id='closeLogin'>&#215;</a>
      </form>
    </div> <!-- login Modal-->
        
    <!-- jquery and foundation -->
    <script src="js/vendor/jquery.js"></script>
    <script src="/js/vendor/fastclick.js"></script>
    <script src="js/foundation.min.js"></script>

    <script>
      $(document).foundation();

      var checked;
      var backendURL = "https://pdit-backend-jcskillings.c9.io/";
      //var backendURL = 'https://stormy-reef-9988.herokuapp.com/';
      
      function redir(){
        window.location.replace("index.html");
      }
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      
      var numUsers;
      var obj;
      var allUsers;
      var numLogs;
      var numMethods;
      var parse;
      var NL;
      var NM;
       
      function newCheckCookie() {
        
        if (getCookie("NL") == null || getCookie("NL") == "" || getCookie("NL") == '{"logs":[]}'){
          setCookie("NL",'{"logs":[]}',30);
          NL = '{"logs":[]}';
          numLogs = 0;
        }
        else {
          parse = JSON.parse(getCookie("NL"));
          numLogs = parse.logs.length; 
        }
        if (getCookie("NM") == null || getCookie("NM") == "" || getCookie("NM") == '{"methods":[]}'){
          setCookie("NM",'{"methods":[]}',30);
          NM = '{"methods":[]}';
          numMethods = 0;
        }
        else {
          parse = JSON.parse(getCookie("NM"));
          numMethods = parse.methods.length;
        }
        
        if (getCookie("allUsers") == null || getCookie("allUsers") =="" || getCookie("allUsers") == '{"users":[]}'){
          setCookie("allUsers",'{"users":[]}',30);
          allUsers = '{"users":[]}';
          numUsers = 0;
        }
        else {
          obj = JSON.parse(getCookie("allUsers"));
          numUsers = obj.users.length;
          if (getCookie("currUser") != "" && getCookie("currUser") != null){
            redir();
          }
        }
        if (getCookie("currUser") != "" && getCookie("currUser") != null){
          //alert("currUser detected!");
          var userTemp = JSON.parse(getCookie("currUser"));
          if(userTemp.username != "" && userTemp.username != null && userTemp.id != null){
            //alert("successfully signed in as "+userTemp.username);
            redir();
          }
        }
      }
      
      
      function checkCookie() {
        var numChecked = getCookie("numChecked");
        var user=getCookie("username");
        var password =getCookie("password");
        if (user == "" && password == "" && numChecked == "") {
          //do nothing but load the page
          setCookie("firstName", "", 0);
        }
        else if(user == "" && password == "" && numChecked == 0) {
          setCookie("numChecked", "", 30);
          redir();
        }
        else if (user != "" && password != "" && numChecked == 0) {
          setCookie("numChecked", 1, 30);
          redir();
        }
        else if (user != "" && password != "" && numChecked == 1) {
          var firstName = getCookie("firstName");
          if (firstName != "" && firstName != null) user = firstName;
          if (confirm("  Welcome back " + user +"!\n(Not " + user + "? Press Cancel)") == true) {
            redir(); //also submit login info to server
          } 
          else {
            setCookie("username", "", 30);
            setCookie("password", "", 30);
            setCookie("numChecked", "", 30);
            setCookie("firstName", "", 30);
            window.location.reload();
          }
        }
      }
      
      // Bill object constructor
      function User(userName, email, firstName, lastName, phone,  password){
        this.userName = userName;
        this.email = email;
        this.firstName = firstName;
        this.lastName = lastName;
        this.phone = phone;
        this.password = password;
      }
      
      function Log(info, date, time) {
        this.info = info;
        this.date = date;
        this.time = time;
      }
      
      function Method(type, destination, carrier, verified, name) {
        this.type = type;
        this.destination = destination;
        this.carrier = carrier;
        this.verified = verified;
        this.name = name;
      }
 
      
      function validateForm() {   
        var userName = document.forms["regForm"]["regUsername"].value;
        /*
        var i;
        for  (i=0; i < numUsers; i++){
          var named = obj.users[i].userName;
          if(userName == named) {
            alert("Please choose another username, " + userName + " is taken");
            return false;
          }
        }
        */
        if (userName == null || userName == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['regForm']['regPassword'].value;
          if(password.length < 8) {
            alert("Password must be at least 8 characters long");
            return false;
          }
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          else {
            var passConfirm = document.forms['regForm']['regPassConfirm'].value;
            if (passConfirm == null || passConfirm == "") {
              alert("Password Confirmation must be filled out");
              return false;
            }
            else if(passConfirm != password){
              alert("Password does not match Password Confirmation");
              return false;
            }
            else {
              
              var dataCollect = document.forms['regForm']['disclaimer'].checked;//checked if data collect is ok
              
              
              var firstName = document.forms['regForm']['regFirstName'].value;
              var lastName = document.forms['regForm']['regLastName'].value;
              var email = document.forms['regForm']['regEmail'].value;
              var phone = document.forms['regForm']['regCell'].value;
              var provider = document.forms['regForm']['mydropdown'].value;
              var jsonRegister = '{"user": {"username":"'+userName+'","email":"' + email + '","first":"' + firstName+'", "last":"'+lastName+
                '", "phone":"' + phone+'", "verifiedAcct":'+dataCollect+', "provider":"'+ provider+ '", "password":"' + password + '"}}';
                //alert("jsonRegister: " + jsonRegister);
              
              if(phone.length > 0 && phone.length < 10){
                alert("Phone number should be ten digits.  Area code + 7-digit local number");
                return;
              }
              var test1 = "-";
              var test2 = "(";
              var test3 = ")";
              var test4 = ".";
              var test5 = "/";
              if(phone.indexOf(test1) != -1 ||phone.indexOf(test2) != -1 ||phone.indexOf(test3) != -1 ||phone.indexOf(test4) != -1 ||phone.indexOf(test5) != -1){
                alert("Phone number should not contain anything except ten digits.");
                return;
              }
              if(phone.length > 0 && provider == "none"){
                alert("You entered a phone number without a provider. Please select a provider and resubmit.  Thank you.");
                return;
              }
              //var newUser = new User(userName, email, firstName, lastName, phone,  password);
              
              //var stringy = JSON.stringify(newUser);
                            
              //$.post('https://pdit-backend-jcskillings.c9.io/user.json', stringy, function(response){
              //  alert("kyle rules");
              //},'json' );
              
              //allUsers = getCookie("allUsers");
              //var temp = allUsers.substring(0, allUsers.length - 2);
              //numUsers = JSON.parse(allUsers).users.length;
              //if(numUsers == 0) allUsers = temp + stringy + "]}";
              //else allUsers = temp + "," + stringy + "]}";
              
              //update allUsers and currUser
              //setCookie("allUsers",allUsers,30);
              //setCookie("currUser", stringy, 30); 
              
              //update notificationLogs and notificationMethods
              //var currDate = Date();
              //alert(currDate);
              //var currTime = currDate.substring(16, 24);
              //alert(currTime);
              //var currTZ = currDate.substring(29, 33);
              //alert(currTZ);
             // currDate = currDate.substring(4, 15);
             
              
              //var newMethod = new Method("email", email, "none", "verified", "email1");
              //var newMethod2 = new Method("cell", phone, provider, "verified", "cell1");
              //alert(newMethod);
              //var newMethod1 = '{"notif_type": {"name": "email1", "destination":"'+email+'", "type": "email", "carrier": "email", "verified": "not verified"}}';
              //var newMethod2 = '{"notif_type": {"name": "phone1", "destination":"'+phone+'", "type": "phone", "carrier": "'+provider+'", "verified": "not verified"}}';
              //alert("about to call addNM 2 times");
             //addNM(newMethod1);
              //addNM(newMethod2);
              /*
              var stringy1 = JSON.stringify(newMethod);
              var stringy2 = JSON.stringify(newMethod2);
              NM = getCookie("NM");
              var temp1 = NM.substring(0, NM.length - 2);
              if(numMethods == 0)  NM = temp1 + stringy1 + "," + stringy2 + "]}";
              else NM = temp1 + "," + stringy1 + "," + stringy2 + "]}";
              setCookie("NM", NM, 30);
              */
              addUser(jsonRegister);
            }
          }
        }
      }
      
      function addNM1(jsonMethod){
        //alert("calling addNM with data = " + jsonMethod);
        var postTry2 = $.ajax({
        type: "POST",
        dataType: 'json',
        //url: 'https://pdit-backend-jcskillings.c9.io/notif_types.json',
        url: backendURL+'notif_types.json',
        data: jsonMethod,
        contentType: 'application/json',
        complete: function(complete){
        //alert("json complete: " +complete);
        },
        success: function(data){
          
          addNL1("You added an unverified Email address!(Please enter the verification code sent to that address at the homepage or in settings!)");
          //var userTemp = JSON.parse(getCookie("currUser"));
          //var phone = userTemp.phone;
          //var carrier = userTemp.provider;
          //var userName = userTemp.username;
          //var newMethod2 = '{"notif_type": {"name": "phone1", "destination":"'+phone+'", "notifMethod": "phone", "carrier": "'+carrier+'", "verified":false, "user_name":"'+userName+'"}}';
          //addNM2(newMethod2);
        },
        error: function(error){
          //alert("error:" + JSON.stringify(error));
        }
        });
      }
      
      function addNM2(jsonMethod){
        //alert("calling addNM with data = " + jsonMethod);
        var postTry2 = $.ajax({
        type: "POST",
        dataType: 'json',
        //url: 'https://pdit-backend-jcskillings.c9.io/notif_types.json',
        url: backendURL+'notif_types.json',
        data: jsonMethod,
        contentType: 'application/json',
        complete: function(complete){
        //alert("json complete: " +complete);
        },
        success: function(data){
          var userTemp = JSON.parse(getCookie("currUser"));
          var provider = userTemp.provider;
          if(provider == "none"){
            addNL2("You added an unverified phone#!(Please select the cellphone carrier in settings so we can send you verification code!)");
          }
          else addNL2("You added an unverified phone#!(Please enter the verification code sent to your phone on the homepage or settings to use it)");
          
        },
        error: function(error){
          alert("error:" + JSON.stringify(error));
        }
        });
      }
      function addUser(jsonString) {
        var postTry = $.ajax({
                //beforeSend : function(jqXHR) {
                //  jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
                //},
          type: "POST",
          dataType: 'json',
          //url: 'https://pdit-backend-jcskillings.c9.io/users.json',
          url: backendURL+'users.json',
          data: jsonString,
          contentType: 'application/json',
          complete: function(complete){
          //alert("json complete: " +complete);
          },
          success: function(data){
            //alert("KYLE!!");
            
          //alert("setting cookie:" + JSON.stringify(data));
            var remember = document.forms['regForm']['checkbox1'].checked;//rememberMe for cookies
            if(remember == true) setCookie("currUser",JSON.stringify(data),30);//change to auth token later?
            else setCookie("currUser",JSON.stringify(data),(0.25));
            
            addNL("You joined Paidit!");
            
          },//redir();//instead call new method to set NL, and NM if one exists
          error: function(error){
            alert("error:" + JSON.stringify(error));
          }
        });
      }
      
      function addNL2(message){
        //alert("NL2 reached");
        var currDate = Date();
        var currTime = currDate.substring(16, 24);
        var currHours = parseInt(currTime.substr(0, 2));
        var ampm;
        if (currHours >=1 && currHours <= 12){
          ampm = " a.m.";
        }
        else if (currHours >= 13){
          currHours = currHours -12;
          ampm = " p.m.";
        }
        else {
          currHours = 1;
          ampm = " a.m.";
        }
        currTime = currHours + currTime.substr(2, 3) + ampm;
        currDate = currDate.substring(4, 15);
        
        var thisUser = JSON.parse(getCookie("currUser"));
        var userName = thisUser.username;
        var newLog = '{"log": {"info": "'+message+'", "date":"'+currDate+'", "time": "'+currTime+'","eventType":"signup", "user_name":"'+userName+'", "hide":false}}';
        
        var postTry2 = $.ajax({
          type: "POST",
          dataType: 'json',
          //url: 'https://pdit-backend-jcskillings.c9.io/logs.json',
          url: backendURL+'logs.json',
          data: newLog,
          contentType: 'application/json',
          complete: function(complete){
          //alert("json complete: " +complete);
          },
          success: function(data){
            //alert("added 2nd NL, now redir");
            redir();
          },
          error: function(error){
            alert("error:" + JSON.stringify(error));
          }
          });
        //setCookie("NL",NL,30);
      }
      
      function addNL1(message){
        //alert("NL1 reached");
        var currDate = Date();
        var currTime = currDate.substring(16, 24);
        var currHours = parseInt(currTime.substr(0, 2));
        var ampm;
        if (currHours >=1 && currHours <= 12){
          ampm = " a.m.";
        }
        else if (currHours >= 13){
          currHours = currHours -12;
          ampm = " p.m.";
        }
        else {
          currHours = 1;
          ampm = " a.m.";
        }
        currTime = currHours + currTime.substr(2, 3) + ampm;
        currDate = currDate.substring(4, 15);
        
        var thisUser = JSON.parse(getCookie("currUser"));
        var userName = thisUser.username;
        var newLog = '{"log": {"info": "'+message+'", "date":"'+currDate+'", "time": "'+currTime+'","eventType":"signup", "user_name":"'+userName+'", "hide":false}}';
        
        var postTry2 = $.ajax({
          type: "POST",
          dataType: 'json',
          //url: 'https://pdit-backend-jcskillings.c9.io/logs.json',
          url: backendURL+'logs.json',
          data: newLog,
          contentType: 'application/json',
          complete: function(complete){
          //alert("json complete: " +complete);
          },
          success: function(data){
            //alert("added 1st NL");
            var userTemp = JSON.parse(getCookie("currUser"));
            var phone = userTemp.phone;
            var carrier = userTemp.provider;
            if(phone != ""){
              var userName = userTemp.username;
              var newMethod2 = '{"notif_type": {"name": "phone1", "destination":"'+phone+'", "notifMethod": "phone", "carrier": "'+carrier+'", "verified":false, "user_name":"'+userName+'"}}';
              //alert("calling adNM")
              addNM2(newMethod2);
            }
            else{
              alert("redir since 2nd NM doesnt exist");
              redir();
            }
            
            
          },
          error: function(error){
            //alert("error:" + JSON.stringify(error));
          }
          });
        //setCookie("NL",NL,30);
      }
      
      function addNL(message){
        //alert("NL reached");
        var currDate = Date();
        var currTime = currDate.substring(16, 24);
        var currHours = parseInt(currTime.substr(0, 2));
        var ampm;
        if (currHours >=1 && currHours <= 12){
          ampm = " a.m.";
        }
        else if (currHours >= 13){
          currHours = currHours -12;
          ampm = " p.m.";
        }
        else {
          currHours = 1;
          ampm = " a.m.";
        }
        currTime = currHours + currTime.substr(2, 3) + ampm;
        currDate = currDate.substring(4, 15);
        
        var thisUser = JSON.parse(getCookie("currUser"));
        var userName = thisUser.username;
        var newLog = '{"log": {"info": "'+message+'", "date":"'+currDate+'", "time": "'+currTime+'","eventType":"signup", "user_name":"'+userName+'", "hide":false}}';
        //var newLog = new Log(message, currDate, currTime);
        //var stringy = JSON.stringify(newLog);
        //var NL = JSON.parse(getCookie("NL"));
        //var numLogs = NL.logs.length;
        //NL=getCookie("NL");
        //var temp = NL.substring(0, NL.length - 2);
        //if (numLogs == 0) {
          //NL = temp + stringy + "]}";
        //}
        //else{
          //NL = temp + "," + stringy + "]}";
        //}
        var postTry2 = $.ajax({
          type: "POST",
          dataType: 'json',
          //url: 'https://pdit-backend-jcskillings.c9.io/logs.json',
          url: backendURL+'logs.json',
          data: newLog,
          contentType: 'application/json',
          complete: function(complete){
          //alert("json complete: " +complete);
          },
          success: function(data){
            var email = thisUser.email;
            var phone = thisUser.phone;
            var carrier = thisUser.provider;
            if(email != ""){
              var newMethod1 = '{"notif_type": {"name": "email1", "destination":"'+email+'", "notifMethod": "email", "carrier": "email", "verified":false, "user_name":"'+userName+'"}}';
              //alert("calling adNM")
              addNM1(newMethod1);
            }
            else if(phone != ""){
              var newMethod2 = '{"notif_type": {"name": "phone1", "destination":"'+phone+'", "notifMethod": "phone", "carrier": "'+carrier+'", "verified":false, "user_name":"'+userName+'"}}';
              //alert("calling adNM")
              addNM2(newMethod2);
            }
            else{
              //alert("added NL redirecting");
              redir();
            }
          },
          error: function(error){
            alert("error:" + JSON.stringify(error));
          }
          });
        //setCookie("NL",NL,30);
      }
      
      function oldValidateForm() {   
      var user = document.forms["regForm"]["regUsername"].value;
        if (user == null || user == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['regForm']['regPassword'].value;
          
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          if(password.length < 6) {
            alert("Password must be at least 6 characters long");
            return false;
          }
          
          else {
            var passConfirm = document.forms['regForm']['regPassConfirm'].value;
            if (passConfirm == null || passConfirm == "") {
              alert("Password Confirmation must be filled out");
              return false;
            }
            else if(passConfirm != password){
              alert("Password does not match Password Confirmation");
              return false;
            }
            else {
              checked = document.forms['regForm']['checkbox1'].checked;
              var firstName = document.forms['regForm']['regFirstName'].value;
              if (checked == true) {
                if (firstName != "" && firstName != null) setCookie("firstName", firstName, 30);
                //send new user info to server
                setCookie("username", user, 30);
                setCookie("password", password, 30);
                setCookie("numChecked", 0, 30);
                redir();
              }
              if(checked == false){
                //send new user info to server before clearing cookies
                setCookie("username", "", 30);
                setCookie("password", "", 30);
                setCookie("numChecked", 0, 30);
                setCookie("firstName", "", 30);
                redir();
              }
            }
          }
        }
      }
      
      function validateLoginForm() {   
        var userName = document.forms["loginForm"]["loginUsername"].value;
        var i;
        var found = false;
        var id;
        if (userName == null || userName == "") {
          alert("Name must be filled out");
          return false;
        }
        for  (i=0; i < numUsers; i++){
          var named = obj.users[i].userName;
          if(userName == named) {
            found = true;
            id = obj.users[i].id;
            break;
          }
        }
        if(found == false) {
          alert("username not found");
          return false;
        }
        else {
          var password = document.forms['loginForm']['loginPassword'].value;
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          named = obj.users[i].password;
          if(password != named) {
            alert("incorrect password");
            return false;
          }
          else {
            //obj.users[i].userStatus = "signed in";
            //obj = JSON.stringify(obj);
            //setCookie("allUsers", obj, 30);
            
            //setCookie("currUser", obj.users[i], 30);
            // HTTP sign in then redirect
            
            signInHTTP();
            
            
            redir();
          }
        }
      }
      
      $('#loginSubmit').click(function (){
         valLogin();
      });
      
      $('#regSubmit').click(function (){
         valRegister();
      });
      
      function valRegister(){
        validateForm();
      }
      
      function valLogin(){
        signInHTTP(); 
      }
      
      function registerHTTP(){//how to check if username already exists?
        
        
        
      }
    
      
      // return a user object parsed from json from the backend
      function signInHTTP(){
        var username = document.forms["loginForm"]["loginUsername"].value;
        var remember = document.forms["loginForm"]["checkbox2"].checked;
        var password =document.forms["loginForm"]["loginPassword"].value;
        
        if (username == null || username == "") {
          alert("Name must be filled out");
          return;
        } 
        else if (password == null || password == "") {
          alert("Password must be filled out");
          return;
        }
        else if (password.length < 8){
          alert("Incorrect Password");
          return;
        }
        
        var jsonLogin = '{"user": {"login": "' + username + '", "password": "' + password + '" }}';
        //alert(jsonLogin);
        //send login request to backend
         var postTry = $.ajax({
        //beforeSend : function(jqXHR) {
        //  jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
        //},
          type: "POST",
          dataType: 'json',
          //url: 'https://pdit-backend-jcskillings.c9.io/users/sign_in.json',
          url: backendURL+'users/sign_in.json',
          data: jsonLogin,
          contentType: 'application/json',
          complete: function(complete){
            //alert("json complete: " +complete);
          },
          success: function(data){
            //alert("setting cookie:" + JSON.stringify(data));
            if(remember == true) setCookie("currUser", JSON.stringify(data),30);
            else setCookie("currUser", JSON.stringify(data),0.25);
            //setCookie("currUser", JSON.stringify(data),30);
            redir();
          },
          error: function(error){
            alert("error:" + JSON.stringify(error));
          }
        }); 
        if (postTry.readyState == 1) {
          //redir()
        }
      } //end signInHTTP
      
      function ConvertFormToJSON(form){
          var array = jQuery(form).serializeArray();
          var json = {};
          
          jQuery.each(array, function() {
              json[this.dbName] = this.value || '';
              //alert('cur value: '+this.value());
          });
          
          return json;
      }
      
      
      
      
      
      
      
      
      
      function oldValidateLoginForm() {   
      var user = document.forms["loginForm"]["loginUsername"].value;
        if (user == null || user == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['loginForm']['loginPassword'].value;
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          else {
            checked = document.forms['loginForm']['checkbox2'].checked;
            if(checked == true) {
              setCookie("username", user, 30);
              setCookie("password", password, 30);
              setCookie("numChecked", 0, 30);
              //send login info to server and verify before redirecting
              redir();
            } 
            else {
              setCookie("username", "", 30);
              setCookie("password", "", 30);
              setCookie("numChecked", 0, 30);
              //send login info to server and verify before redirecting
              redir();
            }
          }
        }
      }
      
      $(".clearLoginForm").on("click",function(){
      $("#loginForm").removeClass("error");
      $("#loginForm").removeClass("error");
      $("#loginForm")[0].reset();
      });
      
      $(".clearRegForm").on("click",function(){
      $("#regForm").removeClass("error");
      $("#regForm").removeClass("error");
      $("#regForm")[0].reset();
      });
      
    </script>
  </body>
</html>