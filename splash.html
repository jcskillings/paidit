<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Simple Bill Management</title>
    <link rel="stylesheet" href="css/test.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/splash.css" />
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>
    <script src="js/vendor/modernizr.js"></script>

  </head>
 
  <body onload="newCheckCookie()">

    <div class="row fullWidth" id="tipTopRow"></div>
    
    <div class="row fullWidth" div id="topRow">
      <div class="large-2  xlarge-2 columns">
        <a><img src="img/logoSm.png" id="mainLogo"/></a>
      </div>
      <div class="large-4 columns">
        <ul class="button-group radius even-2 " id="loginButtons">
          <li><a href="#" data-reveal-id="regModal" class="button clearRegForm">Sign up</a></li>
          <li><a href="#" data-reveal-id="loginModal" class=" button clearLoginForm" id="btnLogin">Log in</a></li>
        </ul>
      </div>
    </div>
    
    <div id="middle" >
      <div class="row">
        <div class="large-10  large-centered columns">
           <h1 data-tooltip aria-haspopup="true" class="has-tip" title="Our goal is to help remind you to pay your bills before they become overdue">
             Features of  <img src="img/paiditkyle.png" height="102" width="152"><h6 align = "right">(*verification is required for each phone/email)</h6></h1>
           <p>- Create Bills to receive notification reminders</p>
           <p>- Receieve your Bill notifications via email* and/or text*</p>
           <p>- View your Bill information on useful charts and graphs</p>
           <p>- You can attach multiple emails*/phone numbers* so you and anyone else who needs to know about a bill due date can be notified</p>
           <p>- A log is kept so you can know what has been sent/created/deleted</p>
           <p>- Calendar to easily view upcoming and late bills</p>
           <p>- Include reminders so notifications can be sent before a bill is due</p>

        </div>
      </div>
    </div>
    
    <div class="row fullWidth" id="bottomRow">
      <div class="large-12 xlarge-12 columns">
        <p>More information</p>
      </div>
    </div>
    
    <!--  registration modal-->
    <div div id="regModal" class="reveal-modal tiny" data-reveal aria-labelledby="Sign Up" aria-hidden="true" role="dialog">
      <div class="row">
          <div class="large-6 large-centered columns">
            <a><img src="img/logoSm.png" /></a>
          </div>
        </div>
      <form id="regForm" data-abide name='regForm' onsubmit="return validateForm()" method="post">
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Username 
              <input type="text" placeholder="username" id='regUsername' name='regUsername' required/>
            </label>
            <small class="error">username is required </small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Password 
              <input type="password" placeholder="********" id='regPassword' name='regPassword' required />
            </label>
            <small class="error">password is required</small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Confirm Password
              <input type="password" placeholder="*******" id='regPassConfirm' name = 'regPassConfirm' required data-equalto="regPassword"/>
            </label>
            <small class="error">passwords do not match</small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>First Name
              <input type="text" placeholder="first name" id='regFirstName' name='regFirstName'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Last Name
              <input type="text" placeholder="last name" id='regLastName' name='regLastName'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Email Address
              <input type="text" placeholder="you@example.com" id='regEmail' name = 'regEmail'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <!-- tooltip not displaying correctly -->
            <label>Cell Phone <span data-tooltip aria-haspopup="true" class="has-tip right" title="to receive text notifications a cell phone number is required">?</span>
              <input type="text" placeholder="555-123-4567" id='regCell' name = 'regCell'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <input id="checkbox1" type="checkbox"><label for="checkbox1">Remember Me</label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <input href="#" type="submit" class="radius button" value="Sign up"/>
          </div>
        </div>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
      </form>
    </div>     <!--  registration modal-->

    <!-- Login modal-->
    <div div id="loginModal" class="reveal-modal tiny" data-reveal aria-labelledby="Register" aria-hidden="true" role="dialog">
      <form id ="loginForm" data-abide name='loginForm' onsubmit="return validateLoginForm()" method = "post">
        
        <div class="row">
          <div class="large-6  large-centered columns">
            <label>Username
              <input type="text" placeholder="username" id='loginUsername' name = 'loginUsername'/>
            </label>   
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Password
              <input type="password" placeholder="********" id='loginPassword' name = 'loginPassword'/>
            </label>   
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <input id="checkbox2" type="checkbox"><label for="checkbox2">Remember Me</label>
          </div>
        </div>
         
        <div class="row">
          <div class="large-4 large-centered columns">
            <input href="#" class="radius button" type = "submit" value = "Log In"/>
          </div>
        </div>
        <a type='reset' class='close-reveal-modal clearLoginForm' aria-label='Close' id='closeLogin'>&#215;</a>
      </form>
    </div> <!-- login Modal-->
        
    <!-- jquery and foundation -->
    <script src="js/vendor/jquery.js"></script>
    <script src="/js/vendor/fastclick.js"></script>
    <script src="js/foundation.min.js"></script>

    <script>
      $(document).foundation();

      var checked;

      
      function redir(){
        window.location.replace("index.html");
      }
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      
      var numUsers;
      var obj;
      var allUsers;
      var numLogs;
      var numMethods;
      var numBills;
      var parse;
      var NL;
      var NM;
      var allBills;
      
      function newCheckCookie() {
        if (getCookie("NL") == null || getCookie("NL") == "" || getCookie("NL") == '{"logs":[]}'){
          setCookie("NL",'{"logs":[]}',30);
          NL = '{"logs":[]}';
          numLogs = 0;
        }
        else {
          parse = JSON.parse(getCookie("NL"));
          numLogs = parse.logs.length; 
        }
        if (getCookie("NM") == null || getCookie("NM") == "" || getCookie("NM") == '{"methods":[]}'){
          setCookie("NM",'{"methods":[]}',30);
          NM = '{"methods":[]}';
          numMethods = 0;
        }
        else {
          parse = JSON.parse(getCookie("NM"));
          numMethods = parse.methods.length;
        }
        if (getCookie("allBills") == null || getCookie("allBills") =="" || getCookie("allBills") == '{"bills":[]}'){
          setCookie("allBills",'{"bills":[]}',30);
          allBills = '{"bills":[]}';
          numBills = 0;
        }
        else {
          parse = JSON.parse(getCookie("allBills"));
          numBills = parse.bills.length;
        }
        if (getCookie("allUsers") == null || getCookie("allUsers") =="" || getCookie("allUsers") == '{"users":[]}'){
          setCookie("allUsers",'{"users":[]}',30);
          allUsers = '{"users":[]}';
          numUsers = 0;
        }
        else {
          obj = JSON.parse(getCookie("allUsers"));
          numUsers = obj.users.length;
          if (getCookie("currUser") != "" && getCookie("currUser") != null){
            redir();
          }
        }
      }
      
      
      function checkCookie() {
        var numChecked = getCookie("numChecked");
        var user=getCookie("username");
        var password =getCookie("password");
        if (user == "" && password == "" && numChecked == "") {
          //do nothing but load the page
          setCookie("firstName", "", 0);
        }
        else if(user == "" && password == "" && numChecked == 0) {
          setCookie("numChecked", "", 30);
          redir();
        }
        else if (user != "" && password != "" && numChecked == 0) {
          setCookie("numChecked", 1, 30);
          redir();
        }
        else if (user != "" && password != "" && numChecked == 1) {
          var firstName = getCookie("firstName");
          if (firstName != "" && firstName != null) user = firstName;
          if (confirm("  Welcome back " + user +"!\n(Not " + user + "? Press Cancel)") == true) {
            redir(); //also submit login info to server
          } 
          else {
            setCookie("username", "", 30);
            setCookie("password", "", 30);
            setCookie("numChecked", "", 30);
            setCookie("firstName", "", 30);
            window.location.reload();
          }
        }
      }
      
      // Bill object constructor
      function User(userName, password, firstName, lastName, id, userStatus){
        this.userName = userName;
        this.firstName = firstName;
        this.lastName = lastName;
        this.password = password;
        this.id = id;
        this.userStatus= userStatus;
      }
      
      function Log(logArray, id) {
        this.logArray = logArray;
        this.id = id;
      }
      
      function Method(methodArray, id) {
        this.methodArray = methodArray;
        this.id = id;
      }
      
      function Bill(billArray, id) {
        this.billArray = billArray;
        this.id = id;
      }
      
      function validateForm() {   
        var userName = document.forms["regForm"]["regUsername"].value;
        var i;
        for  (i=0; i < numUsers; i++){
          var named = obj.users[i].userName;
          if(userName == named) {
            alert("Please choose another username, " + userName + " is taken");
            return false;
          }
        }
        if (userName == null || userName == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['regForm']['regPassword'].value;
          if(password.length < 6) {
            alert("Password must be at least 6 characters long");
            return false;
          }
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          else {
            var passConfirm = document.forms['regForm']['regPassConfirm'].value;
            if (passConfirm == null || passConfirm == "") {
              alert("Password Confirmation must be filled out");
              return false;
            }
            else if(passConfirm != password){
              alert("Password does not match Password Confirmation");
              return false;
            }
            else {
              var checked = document.forms['regForm']['checkbox1'].checked;
              var firstName = document.forms['regForm']['regFirstName'].value;
              var lastName = document.forms['regForm']['regLastName'].value;
              var id = numUsers+1;
              var userStatus = "signed in";
              var newUser = new User(userName, password, firstName, lastName, id, userStatus);
              
              var stringy = JSON.stringify(newUser);
              allUsers = getCookie("allUsers");
              var temp = allUsers.substring(0, allUsers.length - 2);
              if (numUsers == 0) {
                allUsers = temp + stringy + "]}";
              }
              else{
                allUsers = temp + "," + stringy + "]}";
              }
              
              //update allUsers and currUser
              setCookie("allUsers",allUsers,30);
              setCookie("currUser", id, 30);
              
              //update notificationLogs and notificationMethods
              var currDate = Date();
              var currTime = currDate.substring(16, 24);
              var currDay = currDate.substring(0, 3);
              currDate = currDate.substring(4, 15);
             
              var tempArray =[{"type":"email", "destination":"document.forms['regForm']['regEmail'].value", "carrier":null, "verified":false}];
              //var tempArray = [{"type":"email", "destination":document.forms['regForm']['regEmail'].value, "carrier":null, "verified":false},
              //            {"type":"cell", "destination":document.forms['regForm']['regCell'].value, "carrier":"", "verified":false}];
              var newMethod = new Method(tempArray, id);
              alert(newMethod);
              var stringy1 = JSON.stringify(newMethod);
              NM = getCookie("NM");
              var temp1 = NM.substring(0, NM.length - 2);
              if (numMethods == 0) {
                NM = temp1 + stringy1 + "]}";
              }
              else {
                NM = temp1 + "," + stringy1 + "]}";
              }
              alert("NM is " + NM);
              setCookie("NM", NM, 30);
              
              if (document.forms['regForm']['regEmail'].value == "" && document.forms['regForm']['regCell'].value == ""){
                tempArray = [{"info":"You joined Paidit!", "date":currDate, "time":currTime}];
              }
              else if(document.forms['regForm']['regEmail'].value != "") {
                tempArray = [{"info":"You joined Paidit!", "date":currDate, "time":currTime},
                  {"info":"You added an unverified Email address!</br>(Please enter the verification code sent to that address at the homepage or in settings!)", "date":currDate, "time":currTime}];
              }
              else if(document.forms['regForm']['regCell'].value != "") {
                tempArray = [{"info":"You joined Paidit!", "date":currDate, "time":currTime},
                  {"info":"You added an unverified cellphone number!</br>(Please select the cellphone carrier in settings so we can send you verification code!)", "date":currDate, "time":currTime}];
              }
              var newLog = new Log(tempArray, id);
              stringy = JSON.stringify(newLog);
              NL = (getCookie("NL"));
              temp = NL.substring(0, NL.length - 2);
              if (numLogs == 0) {
                NL = temp + stringy + "]}";
              }
              else{
                NL = temp + "," + stringy + "]}";
              }
              alert("NL is " + NL);
              setCookie("NL",NL,30);
              
              tempArray = [];
              var newBill = new Bill(tempArray, id);
              stringy = JSON.stringify(newBill);
              allBills = getCookie("allBills");
              temp = allBills.substring(0, allBills.length - 2);
              if (numBills == 0) {
                allBills = temp + stringy + "]}";
              }
              else {
                allBills = temp + "," + stringy + "]}";
              }
              
              setCookie("allBills", allBills, 30);
              
              redir();
              
            }
          }
        }
      }
      
      
      
      function oldValidateForm() {   
      var user = document.forms["regForm"]["regUsername"].value;
        if (user == null || user == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['regForm']['regPassword'].value;
          
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          if(password.length < 6) {
            alert("Password must be at least 6 characters long");
            return false;
          }
          
          else {
            var passConfirm = document.forms['regForm']['regPassConfirm'].value;
            if (passConfirm == null || passConfirm == "") {
              alert("Password Confirmation must be filled out");
              return false;
            }
            else if(passConfirm != password){
              alert("Password does not match Password Confirmation");
              return false;
            }
            else {
              checked = document.forms['regForm']['checkbox1'].checked;
              var firstName = document.forms['regForm']['regFirstName'].value;
              if (checked == true) {
                if (firstName != "" && firstName != null) setCookie("firstName", firstName, 30);
                //send new user info to server
                setCookie("username", user, 30);
                setCookie("password", password, 30);
                setCookie("numChecked", 0, 30);
                redir();
              }
              if(checked == false){
                //send new user info to server before clearing cookies
                setCookie("username", "", 30);
                setCookie("password", "", 30);
                setCookie("numChecked", 0, 30);
                setCookie("firstName", "", 30);
                redir();
              }
            }
          }
        }
      }
      
      function validateLoginForm() {   
        var userName = document.forms["loginForm"]["loginUsername"].value;
        var i;
        var found = false;
        var id;
        if (userName == null || userName == "") {
          alert("Name must be filled out");
          return false;
        }
        for  (i=0; i < numUsers; i++){
          var named = obj.users[i].userName;
          if(userName == named) {
            found = true;
            id = obj.users[i].id;
            break;
          }
        }
        if(found == false) {
          alert("username not found");
          return false;
        }
        else {
          var password = document.forms['loginForm']['loginPassword'].value;
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          named = obj.users[i].password;
          if(password != named) {
            alert("incorrect password");
            return false;
          }
          else {
            obj.users[i].userStatus = "signed in";
            obj = JSON.stringify(obj);
            setCookie("allUsers", obj, 30);
            setCookie("currUser", id, 30);
            redir();
          }
        }
      }
      
      function oldValidateLoginForm() {   
      var user = document.forms["loginForm"]["loginUsername"].value;
        if (user == null || user == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['loginForm']['loginPassword'].value;
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          else {
            checked = document.forms['loginForm']['checkbox2'].checked;
            if(checked == true) {
              setCookie("username", user, 30);
              setCookie("password", password, 30);
              setCookie("numChecked", 0, 30);
              //send login info to server and verify before redirecting
              redir();
            } 
            else {
              setCookie("username", "", 30);
              setCookie("password", "", 30);
              setCookie("numChecked", 0, 30);
              //send login info to server and verify before redirecting
              redir();
            }
          }
        }
      }
      
      $(".clearLoginForm").on("click",function(){
      $("#loginForm").removeClass("error");
      $("#loginForm").removeClass("error");
      $("#loginForm")[0].reset();
      });
      
      $(".clearRegForm").on("click",function(){
      $("#regForm").removeClass("error");
      $("#regForm").removeClass("error");
      $("#regForm")[0].reset();
      });
      
    </script>
  </body>
</html>