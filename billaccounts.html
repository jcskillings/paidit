<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Bills</title>
    <link rel="stylesheet" href="css/billaccounts.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/responsive-tables.css"/>
    <link rel="stylesheet" href="css/test.css"/>
    
    <script type="text/javascript" src="js/bills.js"></script>
    <script type="text/javascript" src="js/responsive-tables.js"></script>
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>

    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body onload="getBills()">
    
      
      <div class="icon-bar five-up">
        <a class="item" href="index.html">
          <img src="img/icon/homeIconG.png" height="20" width="20"  >
          <label class="show-for-medium-up">Home</label>
        </a>
        <a class="item" href="analysis.html">
          <img src="img/icon/chartsIconG.png" height="20" width="20">
          <label class="show-for-medium-up">Bill Analysis</label>
        </a>
        <a class="item" href="billaccounts.html" id="bills">
          <img src="img/icon/billIconG.png" height="20" width="20">
          <label class="show-for-medium-up"><b>Bills</b></label>
        </a>
        <a class="item" href="notificationslog.html">
          <img src="img/icon/smsIconG.png" height="20" width="20">
          <label class="show-for-medium-up">Notification Log</label>
        </a>
        <a class="item" href="usersettings.html">
          <img src="img/icon/gearIconG.png" height="20" width="20">
          <label class="show-for-medium-up">Settings</label>
        </a>
      </div>
   

    <div class="container navigation">

      
      <div class="small-12 small-centered large-12 large-centered columns">
        <div class="large-1 columns" align = "center">
          <a href="#" class='button radius' id='addBill' >Add Bill</a>
        </div>
          <!-- BILL LIST -->
        <table class="small-11 large-11 columns" id="billTable" name = "billTable">
          <thead  id="billTableHeader">
            <tr>
              <th>Bill</th>
              <th>Due On</th>
              <th>Amount</th>
              <th>URL</th>
              <th>Notifications</th>
              <th>Edit</th>
            </tr>
          </thead>
          <tbody >
            <tr>
              <td>Bill name</td>
              <td>1st of month</td>
              <td>$500.00</td>
              <!--<td ><img src="img/icon/emailIcon40px.png"/>
              <img src="img/icon/smsIcon40px.png"/>
              </td> -->
              
              <td>www.charter.com</td>
              
              <td>Email, SMS</td>
              <!-- <td class="editBox"><img src="img/icon/editIcon40px.png" /></td> -->
              
          </tbody>
        </table>
          
        <a href="#" class="button radius" id="saveBtn">Save</a>
        <a href="#" class="button radius" id="cancelBtn">Cancel</a>
      </div> 
    </div>

    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    
    <script>
      $(document).foundation();
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }
 
      //$('#dp1').fdatepicker();
    
      //var billsExist = true;
      var i;
      var getSuccess = 'no';
      var allBills = '{"bills":[]}';
      // GET BILLS - Runs on pageload gets all bills stored in cookies ======
      function getBills() {
        //alert(document.cookie);
        for  (i=0; i < 100; i++){
          var obj = JSON.parse(getCookie("allBills"));
          //alert("got bill " + i  + " = " +obj);
          var name = obj.bills[i].name;
          //alert(name);
          var date = obj.bills[i].date;
          var amount = obj.bills[i].amount;
          var url = obj.bills[i].url;
          //alert("got bill " + i  + " = " +obj + "name = " +name+ " date = " + date);
          
          if (name == null || name == ""){
            alert("no bills left");
            break;
          }
          else {
            
            putBill(obj, i);
            //alert("got bill " + i  + " = " + name);
          }
        }
        //if (i==0) {
        //  setCookie("allBills",allBills,30);
        //}
        //alert("i equals " + i);
      }
      
      function putBill(jParse, index) {
        var table = document.getElementById("billTable");
        var row = table.insertRow(index+2);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        cell1.innerHTML = jParse.bills[index].name;
        cell2.innerHTML = jParse.bills[index].date;
        cell3.innerHTML = jParse.bills[index].amount;
        cell4.innerHTML = jParse.bills[index].url;
        cell5.innerHTML = jParse.bills[index].notifs;
      }
      
      function testGet(){
        $.getJSON('https://pdit-backend-jcskillings.c9.io/users/22.json', function( data ){
          var items = [];
          alert(JSON.parse(data));
          $.each( data, function( key, val ) {
          items.push( "<li id='" + key + "'>" + val + "</li>" );
          });
 
          $( "<ul/>", {
            "class": "my-new-list",
            html: items.join( "" )
          }).appendTo( "body" );
          });
      }
      
      function testGet2(){
        $.getJSON('https://pdit-backend-jcskillings.c9.io/users/22', null, function(data){
          alert('did this work???');
          alert(JSON.parse(data));
        });
        
      }
        
      
      // appends individual bill to billTable
      function loadBill(bill){
        
      }
      
      // Gets a cookie by name
      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      // Bill object constructor
      function Bill(name, dueDate, amount, url, notifs ){
        this.name = name;
        this.dueDate = dueDate;
        this.amount = amount;
        this.notifs = notifs;
        this.url = url;
      } 
    
      $('#addBill').click(function(){
        testGet2();
        $('#billTable').find('tbody').append($('<tr id="createBill">')
        .append($('<td><input type="text" placeholder="bill name" id="billname" required /></td>'))
        .append($('<td><input type="date" placeholder="due date" id="dueDate" /></td>'))
        .append($('<td><input type="text" placeholder="amount" id="amount"  /></td>'))
        .append($('<td><input type="text" placeholder="url" id="url"  /></td>'))
        .append($('<td><input id="emailCheckbox" type="checkbox"><label for="emailCheckbox">Email</label></td>'))
        .append($('<td><input id="smsCheckbox" type="checkbox"><label for="smsCheckbox">SMS</label></td>'))
        
        );
        $('#saveBtn').css('visibility','visible');
        $('#cancelBtn').css('visibility','visible');
        //alert("added bill");
        
        
      });
      
      $('#cancelBtn').click( function() {
          $('#createBill').remove();
          $('#saveBtn').css('visibility','hidden');
          $('#cancelBtn').css('visibility','hidden');
      });
      
      
   
      
      $('#saveBtn').click( function() {
        //alert("save bill");
        var notifs = [];
        var name = document.getElementById("billname").value;
        //alert(name);
        var dueDate =  document.getElementById("dueDate").value;
        //alert(dueDate);
        var amount = document.getElementById("amount").value;
        var url = document.getElementById("url").value;
        var email = document.getElementById("emailCheckbox").checked;
        //alert(email);
        var sms = document.getElementById("smsCheckbox").checked;
        if (email == true) {
          notifs[0] = ("email");
          if (sms == true) notifs[1] = ("sms");
        }
        if (email == false){
          if (sms == true) notifs[0] = ("sms");
        }
        //alert(notifs[0]);
        
        var newBill = new Bill(name, dueDate, amount, url, notifs);
        //alert(newBill.name + " " + newBill.dueDate);
        var stringy = JSON.stringify(newBill);
        
        if (i == 0) {
          //alert(allBills + " before with i=0");
          //alert("allBills length is " + allBills.length)
          var tempBills = allBills.substring(0, allBills.length - 2);
          allBills = tempBills + stringy + "]}";
        }
        else{
          allBills = (getCookie("allBills"));
          //alert(allBills + " before with i>0");
          //alert("allBills length is " + allBills.length)
          var tempBills = allBills.substring(0, allBills.length - 2);
          allBills = tempBills + "," + stringy + "]}";
        }
        //alert("added new bill at " + i);
        //alert(allBills +" after");
        
        setCookie("allBills",allBills,30);
        
        window.location.reload();
        
        return "";
      });
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }
      
     
      
    </script>
    
    <!-- EDIT BILL -->
    
    
    
    
    </body>
</html>