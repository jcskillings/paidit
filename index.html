<!doctype html>
<html class="no-js" lang="en">
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Welcome</title>
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>
    <link rel="stylesheet" href="css/test.css" />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  
  <body onload="getBills();changeWelcome();">
    <div class="icon-bar five-up">
      <a class="item" href="index.html" id = "home">
        <img src="img/icon/homeIconG.png" height="20" width="20"  >
        <label class="show-for-medium-up" id="hometext">Home</label>
      </a>
      <a class="item" href="analysis.html">
        <img src="img/icon/chartsIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Bill Analysis</label>
      </a>
      <a class="item" href="billaccounts.html">
        <img src="img/icon/billIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Bills</label>
      </a>
      <a class="item" href="notificationslog.html">
        <img src="img/icon/smsIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Notification Log</label>
      </a>
      <a class="item" href="usersettings.html">
        <img src="img/icon/gearIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Settings</label>
      </a>
    </div>

    <div class="container navigation" style = "width:90%; margin:0% -5% 0% 5%"> 
      <div class="large-10 columns" align = "center">
        <h1 style="font-size:300%" id = "welcome"><b>Welcome to <img src="img/paiditkyleblack.png" height="102" width="152">!</b></h1>
        <div class="panel">
          <p><b>Here is a list of all your upcoming bills:</b></p>
          <table class="small-12 large-12 columns" id="billTable" name = "billTable">
            <thead  id="billTableHeader">
              <tr>
                <th width="13%">Bill</th>
                <th width="15%">Amount</th>
                <th width="14%" style="text-align:center;">Due Date</th>
                <th width="13%" style="text-align:center;">Due Time</th>
                <th width="14%">Notifications</th>
                <th width="21%">Repeat</th>
                <th width = "10%"></th>
              </tr>
            </thead>
            <tbody >
            </tbody>
          </table>
        </div> <!-- panel -->
      </div> 
      <div align = "right" class="large-2 columns">
         <ul class="button-group radius even-1 ">
        <h5><button onClick="logout()" id="logout">Logout</button></h5></ul>
        <h3><u> Useful Links </u></h3>
        <ul style="list-style-type:none">
          <li><a href="http://cfs.wisc.edu/">Center of Financial Security</a></li>
          <li><a href="http://bus.wisc.edu/knowledge-expertise/academic-departments/finance">Finance,Investment,&Banking</a></li>
          <li><a href="http://continuingstudies.wisc.edu/advising/finance.htm">Financial Services</a></li>
          <li><a href="http://www.bussvc.wisc.edu/acct/acct.html">Accounting Services</a></li>
          <li><a href="http://www.asm.wisc.edu/finance-committee.html">Finance Committee@UW-Madison</a></li>
        </ul>
        <p><img src="img/calendarmock.png" height="202" width="202"></p>
        <p><img src="img/piechart.png" height="202" width="202"></p>
        <div class="row fullWidth" div id="topRow">
          <ul class="button-group radius even-1 " id="verificationButton">
            <li><a href="#" data-reveal-id="verModal" class="button clearRegForm">Enter Verification Code Here</a></li>
          </ul>
        </div>
      </div>
    </div>
    
    <hr />
    
    <!--  verification modal-->
    <div div id="verModal" class="reveal-modal tiny" data-reveal aria-labelledby="Verification" aria-hidden="true" role="dialog">
      <div class="row">
        <div class="large-6 large-centered columns">
          <a><img src="img/logoSm.png" /></a>
        </div>
      </div>
      <form id="verForm" data-abide name='verForm' onsubmit="return validateForm()" method="post">
      <div class="row">
        <div class="large-6 large-centered columns">
          <label></br>Enter 10-digit code below
            <input type="text" placeholder="12ab34cd56" id='verCode' name='verCode'/>
          </label>
        </div>
      </div>
      <div class="row">
        <div class="large-6 large-centered columns">
          <input href="#" type="submit" class="radius button" value="Submit Code"/>
        </div>
      </div>
      <a class="close-reveal-modal" aria-label="Close">&#215;</a>
      </form>
    </div>     <!--  verification modal-->
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      var obj;
      var allBills;
      var numBills;
      
      function getBills() {
        if (getCookie("allBills") == null || getCookie("allBills") =="" || getCookie("allBills") == '{"bills":[]}'){
          setCookie("allBills",'{"bills":[]}',30);
          allBills = '{"bills":[]}';
          numBills = 0;
        }
        else {
          obj = JSON.parse(getCookie("allBills"));
          numBills = obj.bills.length;
          var date = Date();
          date = date.substring(4, 15);
          var month = date.substr(0, 3);
          var day = date.substr(4, 2);
          var year = date.substr(7, 4);

          if (month == "Jan") month = 1;
          else if (month == "Feb") month = 2;
          else if (month == "Mar") month = 3;
          else if (month == "Apr") month = 4;
          else if (month == "May") month = 5;
          else if (month == "Jun") month = 6;
          else if (month == "Jul") month = 7;
          else if (month == "Aug") month = 8;
          else if (month == "Sep") month = 9;
          else if (month == "Oct") month = 10;
          else if (month == "Nov") month = 11;
          else if (month == "Dec") month = 12;
          var numInserted = 0;
          for  (var i=0; i < numBills; i++){
            date = obj.bills[i].dueDate;
            var billYear = date.substr(0, 4);
            billYear = parseInt(billYear);
            var billMonth = date.substr(5, 2);
            billMonth = parseInt(billMonth);
            var billDay = date.substr(8, 2);
            billDay = parseInt(billDay);
            if(year==billYear && month==billMonth && day<=billDay){
              putMonthsBill(numInserted);
              numInserted++;
            }
            else if(year==billYear && month+1==billMonth && billDay<=day){
              putMonthsBill(numInserted);
              numInserted++;
            }
            else if(year+1==billYear && month==12 && billMonth == 1 && billDay<=day){
              putMonthsBill(numInserted);
              numInserted++;
            }
          }
        }
      }
      
      var myStuff = [];
      function putMonthsBill(index) {
        var table = document.getElementById("billTable");
        var row = table.insertRow(index+1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        //alert("entered");
        var dueD = obj.bills[index].dueDate;
        var year = dueD.substr(0, 4);
        var month = dueD.substr(5, 2);
        var day = dueD.substr(8, 2);
        var date = month +"/"+day+"/"+year;
        var hour = dueD.substr(11,2);
        var minute= dueD.substr(14, 2);
        hour = parseInt(hour);
        //minute = parseInt(minute);
        var time;
        if (hour >0 && hour < 12) {
          time= hour+":"+minute +" a.m.";
        }
        else if(hour>12) {
          hour = hour-12;
          time= hour+":"+minute +" p.m.";
        }
        else{
          if (hour == 0) time= "12:"+minute +" a.m.";
          if (hour == 12) time= hour+":"+minute +" p.m.";
        }
        var numReminders;
        if(obj.bills[index].reminder1 == "" && obj.bills[index].reminder2 =="") numReminders=0;
        else if (obj.bills[index].reminder1 == "" || obj.bills[index].reminder2 =="")numReminders=1;
        else numReminders = 2;
        var category = obj.bills[index].category;
        var catLength = category.length;
        if(catLength == 3) category = "None selected";
        else {
          while(category.charAt(catLength-1) == ","){
            category = category.substring(0, catLength-1);
            catLength = category.length;
          }
          while(category.charAt(0) == ","){
            category = category.substring(1, catLength);
            catLength = category.length;
          }
        }
        var find = ",,";
        //alert(category.indexOf(find));
        while(category.indexOf(find) != -1){
          var temp1 = category.substring(0, category.indexOf(find));
          var temp2 = category.substring(category.indexOf(find)+1, category.length);
          category = temp1 + temp2;
        }
        
        cell1.innerHTML = obj.bills[index].name;
        cell1.style.fontSize="110%";
        cell2.innerHTML = "$" +obj.bills[index].amountLo+"-$"+obj.bills[index].amountHi;
        cell2.style.fontSize="110%";
        cell3.innerHTML = date;
        cell3.style.fontSize="110%";
        cell3.style.textAlign = "center";
        cell4.innerHTML = time;
        cell4.style.fontSize="110%";
        cell4.style.textAlign = "center";
        cell5.innerHTML = category;
        cell5.style.fontSize="110%";
        cell6.innerHTML = obj.bills[index].repeat + ":"+ numReminders +" reminder(s)";
        cell6.style.fontSize="110%";
        cell7.innerHTML = '<button style="width:50px;" onClick="paidIt(this)" id="paidit">PaidIt?</button>';
      }
      
      
      
      function logout() {
        setCookie("currUser", "", 30);

        window.location.replace("splash.html");
        return;
      }
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      function validateForm() {   
      var code = document.forms["verForm"]["verCode"].value;
        if (code == null || code == "") {
          alert("Verification Code must be filled out to submit");
          return false;
        } 
        else {
          if (code.length < 10 || code.length > 10){
            alert("Code must be of length 10!");
            return false;
          }
        }
      }
      
      var index;
      var obj;
      var name;
      var id;
      function changeWelcome(){
        var currUser = JSON.parse(getCookie("currUser"));
        name = currUser.firstName;
        if (name != "" && name != null){
          document.getElementById("welcome").innerHTML = name.bold() + "! ".bold() + document.getElementById("welcome").innerHTML;
          return;
        }
        name = currUser.userName;
        if (name != "" && name != null){
          document.getElementById("welcome").innerHTML = name.bold() + "! ".bold() + document.getElementById("welcome").innerHTML;
        }
        return;
      }
    </script>
  </body>
</html>