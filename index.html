<!doctype html>
<html class="no-js" lang="en">
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Welcome</title>
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>
    <link rel="stylesheet" href="css/test.css" />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  
  <body onload="getBills();changeWelcome();">
    <div class="icon-bar five-up">
      <a class="item" href="index.html" id = "home">
        <img src="img/icon/homeIconG.png" height="20" width="20"  >
        <label class="show-for-medium-up" id="hometext">Home</label>
      </a>
      <a class="item" href="analysis.html">
        <img src="img/icon/chartsIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Bill Analysis</label>
      </a>
      <a class="item" href="billaccounts.html">
        <img src="img/icon/billIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Bills</label>
      </a>
      <a class="item" href="notificationslog.html">
        <img src="img/icon/smsIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Notification Log</label>
      </a>
      <a class="item" href="usersettings.html">
        <img src="img/icon/gearIconG.png" height="20" width="20">
        <label class="show-for-medium-up">Settings</label>
      </a>
    </div>

    <div class="container navigation" style = "width:90%; margin:0% -5% 0% 5%"> 
      <div class="large-10 columns" align = "center">
        <h1 style="font-size:300%" id = "welcome"><b>Welcome to <img src="img/paiditkyleblack.png" height="102" width="152">!</b></h1>
        <div class="panel">
          <p><b>Here is a list of all your upcoming bills:<br/>(Paid bills will remain here until the end of the day)</b></p>
          <table class="small-12 large-12 columns" id="billTable" name = "billTable">
            <thead  id="billTableHeader">
              <tr>
                <th width="11%">Bill</th>
                <th width="13%">Amount</th>
                <th width="12%" style="text-align:center;">Due Date</th>
                <th width="11%" style="text-align:center;">Due Time</th>
                <th width="14%">Notifications</th>
                <th width="21%">Repeat</th>
                <th width="8%" style="text-align:center;">Link</th>
                <th width = "10%"></th>
              </tr>
            </thead>
            <tbody >
            </tbody>
          </table>
        </div> <!-- panel -->
      </div> 
      <div align = "right" class="large-2 columns">
         <ul class="button-group radius even-1 ">
        <h5><button onClick="logout()" id="logout">Logout</button></h5></ul>
        <h3><u> Useful Links </u></h3>
        <ul style="list-style-type:none">
          <li><a href="http://cfs.wisc.edu/">Center of Financial Security</a></li>
          <li><a href="http://bus.wisc.edu/knowledge-expertise/academic-departments/finance">Finance,Investment,&Banking</a></li>
          <li><a href="http://continuingstudies.wisc.edu/advising/finance.htm">Financial Services</a></li>
          <li><a href="http://www.bussvc.wisc.edu/acct/acct.html">Accounting Services</a></li>
          <li><a href="http://www.asm.wisc.edu/finance-committee.html">Finance Committee@UW-Madison</a></li>
        </ul>
        <p><img src="img/calendarmock.png" height="202" width="202"></p>
        <p><img src="img/piechart.png" height="202" width="202"></p>
        <div class="row fullWidth" div id="topRow">
          <ul class="button-group radius even-1 " id="verificationButton">
            <li><a href="#" data-reveal-id="verModal" class="button clearRegForm">Enter Verification Code Here</a></li>
          </ul>
        </div>
      </div>
    </div>
    
    <hr />
    
    <!--  verification modal-->
    <div div id="verModal" class="reveal-modal tiny" data-reveal aria-labelledby="Verification" aria-hidden="true" role="dialog">
      <div class="row">
        <div class="large-6 large-centered columns">
          <a><img src="img/logoSm.png" /></a>
        </div>
      </div>
      <form id="verForm" data-abide name='verForm' onsubmit="return validateForm()" method="post">
      <div class="row">
        <div class="large-6 large-centered columns">
          <label></br>Enter 10-digit code below
            <input type="text" placeholder="12ab34cd56" id='verCode' name='verCode'/>
          </label>
        </div>
      </div>
      <div class="row">
        <div class="large-6 large-centered columns">
          <input href="#" type="submit" class="radius button" value="Submit Code"/>
        </div>
      </div>
      <a class="close-reveal-modal" aria-label="Close">&#215;</a>
      </form>
    </div>     <!--  verification modal-->
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      var obj;
      var allBills;
      var numBills;
      var atBill;
      var numInserted;
      var atBills = [];
      function getBills() {
        if (getCookie("allBills") == null || getCookie("allBills") =="" || getCookie("allBills") == '{"bills":[]}'){
          setCookie("allBills",'{"bills":[]}',30);
          allBills = '{"bills":[]}';
          numBills = 0;
        }
        else {
          obj = JSON.parse(getCookie("allBills"));
          numBills = obj.bills.length;
          var date = Date();
          date = date.substring(4, 15);
          var month = date.substr(0, 3);
          var day = date.substr(4, 2);
          var year = date.substr(7, 4);
          month = changeMonthToNumber(month);
          
          numInserted = 0;
          for  (atBill=0; atBill < numBills; atBill++){
            date = obj.bills[atBill].dueDate;
            var billYear = date.substr(0, 4);
            billYear = parseInt(billYear);
            var billMonth = date.substr(5, 2);
            billMonth = parseInt(billMonth);
            var billDay = date.substr(8, 2);
            billDay = parseInt(billDay);
            if(year==billYear && month==billMonth && day<=billDay){
              putMonthsBill(numInserted);
              numInserted++;
            }
            else if(year==billYear && month+1==billMonth && billDay<=day){
              putMonthsBill(numInserted);
              numInserted++;
            }
            else if(year+1==billYear && month==12 && billMonth == 1 && billDay<=day){
              putMonthsBill(numInserted);
              numInserted++;
            }
            else if(date.charAt(0)==",") {
              var endDate = obj.bills[atBill].repeat.substr(5,6);
              var endMonth = changeMonthToNumber(endDate.substr(0, 3));
              var endDay = parseInt(endDate.substr(4, 2));
              if(day > endDay) continue;
              if(month > endMonth) continue;
              putMonthsBill(numInserted);
              numInserted++;
            }
          }
        }
      }
      
      function changeMonthToNumber(name) {
        if (name == "Jan") return 1;
        else if (name == "Feb") return 2;
        else if (name == "Mar") return 3;
        else if (name == "Apr") return 4;
        else if (name == "May") return 5;
        else if (name == "Jun") return 6;
        else if (name == "Jul") return 7;
        else if (name == "Aug") return 8;
        else if (name == "Sep") return 9;
        else if (name == "Oct") return 10;
        else if (name == "Nov") return 11;
        else if (name == "Dec") return 12;
      }
      
      var myStuff = [];
      function putMonthsBill(index) {
        var table = document.getElementById("billTable");
        var row = table.insertRow(index+1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        var cell8 = row.insertCell(7);
        atBills[index] = atBill;
        var dueD = obj.bills[atBill].dueDate;
        var tempBill = false;
        if(dueD.charAt(0)==",") {
          tempBill = true;
          dueD = dueD.substring(1, dueD.length);
        }
        var year = dueD.substr(0, 4);
        var month = dueD.substr(5, 2);
        var day = dueD.substr(8, 2);
        var date = month +"/"+day+"/"+year;
        var hour = dueD.substr(11,2);
        var minute= dueD.substr(14, 2);
        hour = parseInt(hour);
        //minute = parseInt(minute);
        var time;
        if (hour >0 && hour < 12) {
          time= hour+":"+minute +" a.m.";
        }
        else if(hour>12) {
          hour = hour-12;
          time= hour+":"+minute +" p.m.";
        }
        else{
          if (hour == 0) time= "12:"+minute +" a.m.";
          if (hour == 12) time= hour+":"+minute +" p.m.";
        }
        var numReminders;
        if(obj.bills[atBill].reminder1 == "" && obj.bills[atBill].reminder2 =="") numReminders=0;
        else if (obj.bills[atBill].reminder1 == "" || obj.bills[atBill].reminder2 =="")numReminders=1;
        else numReminders = 2;
        var category = obj.bills[atBill].category;
        var catLength = category.length;
        if(catLength == 3) category = "None selected";
        else {
          while(category.charAt(catLength-1) == ","){
            category = category.substring(0, catLength-1);
            catLength = category.length;
          }
          while(category.charAt(0) == ","){
            category = category.substring(1, catLength);
            catLength = category.length;
          }
        }
        var find = ",,";
        //alert(category.indexOf(find));
        while(category.indexOf(find) != -1){
          var temp1 = category.substring(0, category.indexOf(find));
          var temp2 = category.substring(category.indexOf(find)+1, category.length);
          category = temp1 + temp2;
        }
        
        var check1 = "http";
        var check2 = "www";
        var check3 = ".";
        var display = "";
        var loginPage = obj.bills[atBill].loginPage;
        if(loginPage.indexOf(check1)!=-1 ||loginPage.indexOf(check2)!=-1 ||loginPage.indexOf(check3)!=-1){
          if (tempBill == true)display = "<a style='color:#3ADF00;' href="+loginPage+
            " onclick='window.open(this.href); return false;' onkeypress='window.open(this.href); return false;'>Paid At</a>";
          else display = "<a style='color:#3ADF00;' href="+loginPage+" onclick='window.open(this.href); return false;'"+
            "onkeypress='window.open(this.href); return false;'>Pay Bill</a>";
        }
        
        var repeat;
        if(obj.bills[atBill].reminder1 == null || obj.bills[atBill].reminder2 == null) repeat = obj.bills[atBill].repeat;
        else repeat = obj.bills[atBill].repeat + ":"+ numReminders +" reminder(s)";
        
        var lastCell;
        if(tempBill == true) {
          lastCell = "<a href='#'><img src='img/paiditkyleblackE.png' height='90' width='135' border=0/></a>"
        }
        else lastCell = "<a href='#' onclick='paidit(this)'><img src='img/paiditkyleblackQ.png' height='90' width='135' border=0/></a>";
        
        cell1.innerHTML = obj.bills[atBill].name;
        cell1.style.fontSize="110%";
        cell2.innerHTML = "$" +obj.bills[atBill].amountLo+"-$"+obj.bills[atBill].amountHi;
        cell2.style.fontSize="110%";
        cell3.innerHTML = date;
        cell3.style.fontSize="110%";
        cell3.style.textAlign = "center";
        cell4.innerHTML = time;
        cell4.style.fontSize="110%";
        cell4.style.textAlign = "center";
        cell5.innerHTML = category;
        cell5.style.fontSize="110%";
        cell6.innerHTML = repeat;
        cell6.style.fontSize="110%";
        cell7.innerHTML = display ;
        cell7.style.textAlign = "center";
        cell8.innerHTML = lastCell;
        cell8.style.fontSize = "25px";
        cell8.style.fontWeight= 900;
      }
      
      var obj;
      var numBills;
      var newJson;
      var oldJson;
      function paidit(row){
        var p=row.parentNode.parentNode;
        p.parentNode.removeChild(p);
        obj = JSON.parse(getCookie("allBills"));
        numBills = obj.bills.length;
        paiditEditField();
      }
      
      function addNL(message){
        var currDate = Date();
        var currTime = currDate.substring(16, 24);
        currDate = currDate.substring(4, 15);
        var newLog = new Log(message, currDate, currTime);
        var stringy = JSON.stringify(newLog);
        var NL = JSON.parse(getCookie("NL"));
        var numLogs = NL.logs.length;
        NL=getCookie("NL");
        var temp = NL.substring(0, NL.length - 2);
        if (numLogs == 0) {
          NL = temp + stringy + "]}";
        }
        else{
          NL = temp + "," + stringy + "]}";
        }
        setCookie("NL",NL,30);
      }
      
      function Log(info, date, time) {
        this.info = info;
        this.date = date;
        this.time = time;
      }
      
      function paiditEditField(){
        var j;
        var table = document.getElementById("billTable");
        var name = null;
        var category = null;
        var paymentType = null;
        var loginPage = null;
        var dueDate = null;
        var repeat = null;
        var amountLo = null;
        var amountHi = null;
        var user_name = null;
        var reminder1 = null;
        var reminder2 = null;
        newJson = null;
        allBills = getCookie("allBills");
        var find;
        for(j = 1; j < numInserted; j++){
          name = obj.bills[atBills[j-1]].name;
          var row = table.rows[j].cells[0].firstChild.data;
          if (name != row) {
            name = obj.bills[atBills[j-1]].name;
            category = obj.bills[atBills[j-1]].category;
            paymentType = obj.bills[atBills[j-1]].paymentType;
            loginPage = obj.bills[atBills[j-1]].loginPage;
            dueDate = obj.bills[atBills[j-1]].dueDate;
            repeat = obj.bills[atBills[j-1]].repeat;
            amountLo = obj.bills[atBills[j-1]].amountLo;
            amountHi = obj.bills[atBills[j-1]].amountHi;
            user_name = obj.bills[atBills[j-1]].user_name;
            reminder1 = obj.bills[atBills[j-1]].reminder1;
            reminder2 = obj.bills[atBills[j-1]].reminder2;
      
            find = '{"name":"' +name;
            var tempCookie = allBills.substring(0, allBills.indexOf(find));
            var find2 = '{"name":"' +row
            var find3 = ',{"name":"' +row
            oldJson = allBills.substring(allBills.indexOf(find), allBills.indexOf(find3));
            newJson = allBills.substring(allBills.indexOf(find2), allBills.length);
            newJson = tempCookie + newJson;
            break;
          }
        }
        if(newJson == null) { //editing last  & there is more than 1 bill
          name = obj.bills[(atBills[numInserted-1])].name;
          category = obj.bills[(atBills[numInserted-1])].category;
          paymentType = obj.bills[(atBills[numInserted-1])].paymentType;
          loginPage = obj.bills[(atBills[numInserted-1])].loginPage;
          dueDate = obj.bills[(atBills[numInserted-1])].dueDate;
          repeat = obj.bills[(atBills[numInserted-1])].repeat;
          amountLo = obj.bills[(atBills[numInserted-1])].amountLo;
          amountHi = obj.bills[(atBills[numInserted-1])].amountHi;
          user_name = obj.bills[(atBills[numInserted-1])].user_name;
          reminder1 = obj.bills[(atBills[numInserted-1])].reminder1;
          reminder2 = obj.bills[(atBills[numInserted-1])].reminder2;
          if(numBills == 1) find = '{"name":"' +name;
          else find = ',{"name":"' +name;
          oldJson = allBills.substring(allBills.indexOf(find),  allBills.indexOf("]}"));
          newJson = allBills.substring(0, allBills.indexOf(find))+"]}";
        }
        
        var newDueDate = updateDueDate(repeat, dueDate);
        var currDueDate;
        if (newDueDate.indexOf(",") != -1) 
          currDueDate=newDueDate.substring(newDueDate.indexOf(",")+1, newDueDate.length);
        else currDueDate = newDueDate;

        var year = parseInt(currDueDate.substr(0, 4));
        var month = parseInt(currDueDate.substr(5, 2));
        var day = parseInt(currDueDate.substr(8, 2));
        var hour = parseInt(currDueDate.substr(11, 2));
        var minute = parseInt(currDueDate.substr(14, 2));
        var TZ = parseInt(currDueDate.substr(20, 4));
        
        if(reminder1 !=  "") {
          var reminder1Array = reverse(year, month, day, hour, reminder1);
          reminder1 = getDateTime(year, month, day, hour, minute, TZ, reminder1Array[0], reminder1Array[1]);
        }
        if (reminder2 != ""){
          var reminder2Array = reverse(year, month, day, hour, reminder2);
          reminder2 = getDateTime(year, month, day, hour, minute, TZ, reminder2Array[0], reminder2Array[1]);
        }        
        
        var updatedBill = new Bill(name, category, paymentType, loginPage, newDueDate, repeat, amountLo, amountHi, user_name, reminder1, reminder2);
        var stringy = JSON.stringify(updatedBill);
        numBills = JSON.parse(getCookie("allBills")).bills.length;
        allBills = newJson;
        var tempBills = allBills.substring(0, allBills.length - 2);
        if (numBills == 1){
          allBills = tempBills + stringy + "]}";
        }
        else {
          allBills = tempBills + "," + stringy + "]}";
        }
 
        var paidDate = Date();
        var currTime = paidDate.substring(16, 21);
        paidDate = paidDate.substring(4, 10);
        paidDate = "PAID:" + paidDate +" at " + currTime;
        name = "*PAID* " + name;
        dueDate = ","+dueDate;
        var message = "Nice! You Paid your "+ name+"! Any remaining notifications will be canceled.  If there was a repeat selected "+
          "this bill will set to reoccur.";
        addNL(message);
        var tempBill = new Bill(name, category, null, loginPage, dueDate, paidDate, amountLo, amountHi, user_name, null, null);
        tempBill = JSON.stringify(tempBill);
        allBills = '{"bills":['+tempBill+","+allBills.substring(10, allBills.length);
        setCookie("allBills",allBills,30);
        window.location.reload();
      }
      
      // Bill object constructor
      function Bill(name, category, paymentType, loginPage, dueDate, repeat, amountLo, amountHi, user_name, reminder1, reminder2){
        this.name = name;
        this.category = category;
        this.paymentType = paymentType;
        this.loginPage = loginPage;
        this.dueDate = dueDate;
        this.repeat= repeat;
        this.amountLo = amountLo;
        this.amountHi = amountHi;
        this.user_name = user_name;
        this.reminder1 = reminder1;
        this.reminder2 = reminder2;
      } 
      
      function getDateTime(year, month, day, hour, minute, TZ, reminderDays, reminderHours) {
        var finalYear;
        var finalMonth;
        var finalDay;
        var finalHour;
        var daysInPrev;
        
        year = parseInt(year);
        month = parseInt(month);
        hour = parseInt(hour);
        reminderDays = parseInt(reminderDays);
        reminderHours = parseInt(reminderHours);
        var isLeap =new Date(year, 1, 29).getMonth() == 1;
        
        if(month == 5 || month == 7 || month == 10 || month == 12) {
          daysInPrev = 30;
        }
        
        else if(month == 4 || month == 6 || month ==11 || month == 9 || month == 1 || month == 8 || month ==2) {
          daysInPrev = 31;
        }
        else{
          if(isLeap == true) daysInPrev = 29;
          else daysInPrev = 28;
        }
 
        if(hour - reminderHours >= 0) {
          finalHour = hour - reminderHours;
          if(finalHour <10 && finalHour >=0){
            finalHour = "0" + finalHour;
          }
        }
        else {
          finalHour = hour - reminderHours + 24;
          day = day-1;
        }
        if(day - reminderDays >= 1) {
          finalDay = day - reminderDays;
          if(finalDay <10 && finalDay >=1){
            finalDay = "0" + finalDay;
          }
        }
        else {
          month = month -1;
          finalDay = day - reminderDays + daysInPrev;
        }
        if(month > 0){
          finalMonth = month;
          finalYear = year;
          if(finalMonth <10 && finalMonth >0){
            finalMonth = "0" + finalMonth;
          }
        }
        else {
          finalMonth = 12;
          finalYear = year - 1;
        }
       
        var date = finalYear+"-"+finalMonth+"-"+finalDay;
        var time = finalHour +":"+minute+":00";
        var toReturn = date + " " + time + " +" + TZ;
        return toReturn;
      }
      
      function reverse(year, month, day, hour, passedR) {
        var finalRD;
        var finalRH;
        var pyear = parseInt(passedR.substr(0, 4));
        var pmonth = parseInt(passedR.substr(5, 2));
        var pday = parseInt(passedR.substr(8, 2));
        var phour = parseInt(passedR.substr(11, 2));
        
        hour = parseInt(hour);
        year = parseInt(year);
        month = parseInt(month);
        day = parseInt(day);
        
        var isLeap =new Date(year, 1, 29).getMonth() == 1;
        var daysInPrev;
        
        if(month == 5 || month == 7 || month == 10 || month == 12) {
          daysInPrev = 30;
        }
        
        else if(month == 4 || month == 6 || month ==11 || month == 9 || month == 1 || month == 8 || month ==2) {
          daysInPrev = 31;
        }
        else{
          if(isLeap == true) daysInPrev = 29;
          else daysInPrev = 28;
        }
        
        if(hour - phour >= 0) {
          finalRH = hour - phour;
        }
        else {
          finalRH = hour - phour + 24;
          pday = pday + 1;
        }
        if(day - pday >= 0){
          finalRD = day - pday;
        }
        else{
          finalRD = day - pday + daysInPrev;
        }
        
        if(finalRD < 10) finalRD = "0" +finalRD;
        if(finalRH < 10) finalRH = "0" +finalRH;
        return [finalRD, finalRH];
      }
      
      function updateDueDate(repeat, changeDate){
        if(repeat == "Never") return changeDate;
        var year = changeDate.substr(0, 4);
        var month = changeDate.substr(5, 2);
        var day = changeDate.substr(8, 2);
        var hour = changeDate.substr(11, 2);
        var minute = changeDate.substr(14, 2);
        var numDaysCurrMonth = getNumDaysInMonth(month, year);
        var commaLoc = changeDate.indexOf(",");
        if(commaLoc == 0) return changeDate; //dummy due date
        
        month = parseInt(month);
        year = parseInt(year);
        day = parseInt(day);
        numDaysCurrMonth = parseInt(numDaysCurrMonth);

        var finalYear;
        var finalMonth;
        var finalDay;
        var originalDate = null;
        
        if(repeat == "Weekly") {
          if(commaLoc != -1){ //parse to get current dueDate
            changeDate = changeDate.substring(commaLoc + 1, changeDate.length);
            year = parseInt(changeDate.substr(0, 4));
            month = parseInt(changeDate.substr(5, 2));
            day = parseInt(changeDate.substr(8, 2));
          }
          if(day + 7 <= numDaysCurrMonth){
            finalDay = day + 7;
            finalMonth = month;
            finalYear = year;
          }
          else {
            finalDay = day + 7 - numDaysCurrMonth;
            month = month + 1;
            if(month <= 12){
              finalMonth = month;
              finalYear = year;
            }
            else{
              finalMonth = 1;
              finalYear = year + 1;
            }
          }
        }
        else if(repeat == "Biweekly") {
          if(commaLoc != -1){ //parse to get current dueDate
            changeDate = changeDate.substring(commaLoc + 1, changeDate.length);
            year = parseInt(changeDate.substr(0, 4));
            month = parseInt(changeDate.substr(5, 2));
            day = parseInt(changeDate.substr(8, 2));
          }
          if(day + 14 <= numDaysCurrMonth){
            finalDay = day + 14;
            finalMonth = month;
            finalYear = year;
          }
          else {
            finalDay = day + 14 - numDaysCurrMonth;
            month = month + 1;
            if(month <= 12){
              finalMonth = month;
              finalYear = year;
            }
            else{
              finalMonth = 1;
              finalYear = year + 1;
            }
          }
        }
        else if(repeat == "Monthly") { //only 
          var daysInNext = getNumDaysInMonth((month+1), year);
          if(commaLoc != -1){ //parse to get current dueDate but keep original day
            changeDate = changeDate.substring(commaLoc + 1, changeDate.length);
            year = parseInt(changeDate.substr(0, 4));
            month = parseInt(changeDate.substr(5, 2));
          }
          if(day <= daysInNext){
            finalDay = day;
            month = month +1;
            if(month <= 12){
              finalMonth = month;
              finalYear = year;
            }
            else {
              finalMonth = 1;
              finalYear = year + 1;
            }
          }
          else {
            originalDate = changeDate; //what if , exists
            finalDay = daysInNext;
            month = month + 1;
            if(month <= 12){
              finalMonth = month;
              finalYear = year;
            }
            else {
              finalMonth = 1;
              finalYear = year + 1;
            }
          }
        }
        else {
          var numMonths = parseInt(repeat);
          var endMonth = month + numMonths;
          if(commaLoc != -1){ // has original, current dueDates
            var oDay = day;
            var oMonth = month;
            var oYear = year;
            var tempDate = changeDate.substring(commaLoc + 1, changeDate.length);
            
            year = parseInt(tempDate.substr(0, 4));
            month = parseInt(tempDate.substr(5, 2));
            day = parseInt(tempDate.substr(8, 2));
            
            var dueMonth = month + repeat;
            if(dueMonth <= 12) {
              finalMonth = dueMonth;
              finalYear = year;
            }
            else {
              finalMonth = dueMonth - 12;
              finalYear = year + 1;
            }
            var daysInFinalMonth = parseInt(getNumDaysInMonth(finalMonth, finalYear));
            if(oDay <= daysInFinalMonth){
              changeDate = tempDate; //removes original date, not needed
              finalDay = oDay;
            }
            else{ //keeps , in changeDate since original is still needed
              finalDay = daysInFinalMonth;
            }
          }
          else{
            if(endMonth <= 12) {
              finalMonth = endMonth;
              finalYear = year;
            }
            else {
              finalMonth = endMonth - 12;
              finalYear = year + 1;
            }
          }
          var numDaysInFinal = parseInt(getNumDaysInMonth(finalMonth, finalYear));
          if(day <= numDaysInFinal){
            finalDay = day;
          }
          else {
            originalDate = changeDate;
            finalDay = numDaysInFinal;
          }
        }
          
        if(originalDate != null) {
          changeDate = originalDate +","+ changeDate;
        }
        if(finalMonth < 10) finalMonth = "0"+finalMonth;
        if(finalDay < 10) finalDay = "0"+finalDay;
        var finalDueDate=finalYear+"-"+finalMonth+"-"+finalDay+" "+hour+":"+minute+":00 "+
          changeDate.substr(20, 4);
        if(changeDate.indexOf(",") == -1){
          return finalDueDate;
        }
        else{
          finalDueDate = changeDate.substring(0, changeDate.indexOf(",")+1)+finalDueDate;
          return finalDueDate;
        }
          
      }
      
      //return days in month as a string
      function getNumDaysInMonth(month, year){
        month = parseInt(month);
        year = parseInt(year);
        var isLeap =new Date(year, 1, 29).getMonth() == 1;
        if (month == 1 || month == 3 || month==5||month==7||month==8||month==10||month==12){
          return "31";
        }
        else if(month==4||month==6||month==9||month==11){
          return "30";
        }
        else{
          if(isLeap) return "29";
          else return "28";
        }
      }
      
      //return true if day is valid for month and year passed
      function checkValidDate(year, month, day) {
        var daysInCurrent = parseInt(getNumDaysInMonth(month, year));
        day = parseInt(day);
        if(day<=daysInCurrent) return true;
        else return false;
      }
      
      function logout() {
        setCookie("currUser", "", 30);

        window.location.replace("splash.html");
        return;
      }
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      function validateForm() {   
      var code = document.forms["verForm"]["verCode"].value;
        if (code == null || code == "") {
          alert("Verification Code must be filled out to submit");
          return false;
        } 
        else {
          if (code.length < 10 || code.length > 10){
            alert("Code must be of length 10!");
            return false;
          }
        }
      }
      
      var index;
      var obj;
      var name;
      var id;
      function changeWelcome(){
        var currUser = JSON.parse(getCookie("currUser"));
        name = currUser.firstName;
        if (name != "" && name != null){
          document.getElementById("welcome").innerHTML = name.bold() + "! ".bold() + document.getElementById("welcome").innerHTML;
          return;
        }
        name = currUser.userName;
        if (name != "" && name != null){
          document.getElementById("welcome").innerHTML = name.bold() + "! ".bold() + document.getElementById("welcome").innerHTML;
        }
        return;
      }
    </script>
  </body>
</html>